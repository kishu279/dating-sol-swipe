  // This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum PromptCategory {
  FUN
  LIFESTYLE
  VALUES
  ICEBREAKER
}

enum Gender {
  MALE
  FEMALE
  NON_BINARY
  OTHER
}

model User {
  id               String      @id @default(cuid())
  walletPubKey     String      @unique
  isActive         Boolean     @default(true)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  lastActiveAt     DateTime?   // For sorting suggestions by activity

  isVerified   Boolean @default(false)
  isPremium    Boolean @default(false)

  profile          Profile?
  preferences      Preferences?
  photos           Photo[]

  promptAnswers    PromptAnswer[]
  matchesAsFirst   Matches[]   @relation("MatchFirst")
  matchesAsSecond  Matches[]   @relation("MatchSecond")
  swipesGiven      Swipe[]     @relation("UserSwipes")
  swipesReceived   Swipe[]     @relation("UserSwipedOn")

  @@index([walletPubKey])
  @@index([lastActiveAt])
}

model Profile {
  id           String   @id @default(cuid())
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  displayName  String
  age          Int
  gender       Gender
  orientation  String
  bio          String?
  profession   String?
  hobbies      String[] @default([])
  religion     String?
  country      String?  // e.g., "India"
  state        String?  // e.g., "Maharashtra"
  city         String?  // e.g., "Mumbai" (optional, for display)
  heightCm     Int?

  @@index([age])
  @@index([gender])
  @@index([country])
  @@index([state])
  @@index([orientation])
}

enum LocationScope {
  SAME_CITY
  SAME_STATE
  SAME_COUNTRY
  ANY
}

model Preferences {
  id                    String        @id @default(cuid())
  userId                String        @unique
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  preferredGenders      Gender[]      @default([])
  ageMin                Int?
  ageMax                Int?
  locationScope         LocationScope @default(SAME_STATE)  // How far to search
}

model Prompt {
  id          String         @id @default(cuid())
  question    String
  category    PromptCategory
  isActive    Boolean        @default(true)
  order       Int?
  createdAt   DateTime       @default(now())

  answers     PromptAnswer[]
}

model PromptAnswer {
  id         String   @id @default(cuid())
  userId     String
  promptId   String
  answer     String
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  prompt     Prompt   @relation(fields: [promptId], references: [id], onDelete: Cascade)

  @@unique([userId, promptId])
}

model Photo {
  id       String  @id @default(cuid())
  userId   String
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  url      String
  order    Int

  @@index([userId])
}

enum SwipeAction {
  LIKE
  PASS
  DISLIKE
}

model Swipe {
  id         String      @id @default(cuid())
  fromUserId String
  toUserId   String
  action     SwipeAction
  createdAt  DateTime    @default(now())

  fromUser   User        @relation("UserSwipes", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser     User        @relation("UserSwipedOn", fields: [toUserId], references: [id], onDelete: Cascade)

  @@unique([fromUserId, toUserId])
  @@index([toUserId])
}

// model Message {
//   id              String   @id @default(cuid())
//   fromUserId      String
//   toUserId        String
//   content         String
//   createdAt       DateTime @default(now())

//   fromUser        User     @relation("SentMessages", fields: [fromUserId], references: [id])
//   toUser          User     @relation("ReceivedMessages", fields: [toUserId], references: [id])
// }

model Matches {
  id             String   @id @default(cuid())
  firstPersonId  String
  secondPersonId String
  createdAt      DateTime @default(now())

  firstPerson    User     @relation("MatchFirst", fields: [firstPersonId], references: [id], onDelete: Cascade)
  secondPerson   User     @relation("MatchSecond", fields: [secondPersonId], references: [id], onDelete: Cascade)

  @@unique([firstPersonId, secondPersonId])
}